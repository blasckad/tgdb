# Структура данных для версионированных объектов и связей

## Файлы данных

### 1`nodes.parquet` — Узлы (объекты)
**Схема:**
| Поле         | Тип       | Описание                          |
|--------------|-----------|-----------------------------------|
| `node_id`    | UUID      | Уникальный ID узла                |
| `name`       | string    | Логическое имя объекта            |
| `timestamp`  | int64     | Время создания версии (Unix)      |
| `data`       | JSON      | Атрибуты объекта                  |

**Пример данных:**
| node_id | name   | timestamp   | data          |
|---------|--------|-------------|---------------|
| n1      | Alice  | 1708400000  | `{"age": 25}` |
| n2      | Alice  | 1708500000  | `{"age": 26}` |
| n3      | Bob    | 1708400000  | `{"city": "NY"}` |

**Индексы:**
-  **B-Tree**: `(name, timestamp) → node_id`  
  _Поиск версий объекта по времени_
-  **Hash Index**: `node_id → данные`  
  _Мгновенный доступ к данным по ID_

---

### 2 `edges.parquet` — Рёбра (связи)
**Схема:**
| Поле               | Тип       | Описание                          |
|--------------------|-----------|-----------------------------------|
| `edge_id`          | UUID      | Уникальный ID ребра              |
| `source`           | string    | Исходный узел (по имени)          |
| `target`           | string    | Целевой узел (по имени)           |
| `timestamp_start`  | int64     | Начало связи (Unix)               |
| `timestamp_end`    | int64     | Конец связи (Unix)                |
| `data`             | JSON      | Данные о связи                    |

**Пример данных:**
| edge_id | source | target | timestamp_start | timestamp_end | data              |
|---------|--------|--------|-----------------|---------------|-------------------|
| e1      | Alice  | Bob    | 1708400000      | 1710000000    | `{"type": "friend"}` |
| e2      | Alice  | Charlie| 1708500000      | 1710100000    | `{"type": "colleague"}` |

**Индексы:**
-  **B-Tree**: `(source, target, timestamp_start, timestamp_end) → edge_id`  
  _Поиск связей в заданном временном диапазоне_
-  **Hash Index**: `edge_id → данные`  
  _Быстрое извлечение информации о связи_

---

### 3 `edges_index.parquet` — Индекс связей
**Схема:**
| Поле          | Тип       | Описание                          |
|---------------|-----------|-----------------------------------|
| `id`          | UUID      | Уникальный ID записи              |
| `node_name`   | string    | Имя узла                          |
| `direction`   | string    | `in` (входящее) или `out` (исходящее) |
| `edge_id`     | UUID      | Ссылка на ребро в `edges.parquet` |
| `timestamp`   | int64     | Время создания связи (Unix)       |

**Пример данных:**
| id    | node_name | direction | edge_id | timestamp   |
|-------|-----------|-----------|---------|-------------|
| idx1  | Alice     | out       | e1      | 1708400000  |
| idx2  | Bob       | in        | e1      | 1708400000  |

**Индексы:**
-  **B-Tree**: `(node_name, direction, timestamp) → edge_id`  
  _Поиск связей узла по направлению и времени_

---

##  Эффективность запросов
| Запрос                                  | Индексы                            | Скорость  |
|-----------------------------------------|------------------------------------|-----------|
| Найти все версии объекта "Alice"        | B-Tree `(name, timestamp)`         | O(log N)  |
| Найти "Alice" в момент T                | B-Tree `(name, timestamp)`         | O(log N)  |
| Найти все связи "Alice"                 | B-Tree `(node_name)`               | O(log M)  |
| Найти связи "Alice" в диапазоне [T1, T2]| B-Tree `(timestamp_start/end)`     | O(log M)  |

**Примечания:**
- N — количество узлов в `nodes.parquet`
- M — количество связей в `edges.parquet`
